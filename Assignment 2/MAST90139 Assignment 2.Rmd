---
title: "MAST90139 Assignment 2"
author: "Haonan Zhong"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Question 1a
```{r}
x <- c(1.69, 1.72, 1.76, 1.78, 1.81, 1.84, 1.86, 1.88)
n <- c(59, 60, 62, 56, 63, 59, 62, 60)
y <- c(6, 13, 18, 28, 52, 53, 61, 60)

## Compute the empirical logit
emp.logit <- log((y + 0.5)/(n - y + 0.5))
par(mar=c(4,4,1,1))
plot(x, emp.logit, xlab = 'Dosage', ylab = 'Empirical logits')
```
We can see there's a somewhat linear trend presented in the plot.

## Question 1b
```{r}
logistic <- glm(y/n ~ x, family = binomial, weights = n)
summary(logistic)$coef
```
The estimate for the intercept is -60.10328, and the slope is 33.93416.

## Question 1c
```{r}
confint(logistic)
```
The 95% confidence interval for the slope is (28.54467, 39.96005).

## Question 1d
Given that $logit(0.5) = \frac{0.5}{1-0.5} = 0$.
\[-60.1033 + 33.9341\times dosage = 0\]
Solving the above equation yields dosage = 1.7712. Therefore, the estimate of the dosage that will kill 50% of the beetles is 1.7712.

## Question 1e
```{r}
# Compute the odds ratio
beta1 <- summary(logistic)$coef[2]
(odds <- exp(0.1 * beta1))
```
The estimated odds of being killed for a 0.1 increase in dosage is 29.76749.
```{r}
exp(0.1*confint(logistic)[2,])
```
And the 95% confidence interval for the odds ratio is (17.36518, 54.38045).

## Question 1f
```{r}
etahat <- summary(logistic)$coef[1] + summary(logistic)$coef[2] * 1.8
(probability <- exp(etahat)/(1 + exp(etahat)))
```
```{r}
X.pred <- matrix(c(1, 1.8), nrow = 1, ncol = 2)
se <- sqrt(X.pred %*% summary(logistic)$cov.scaled %*% t(X.pred))
eta_l <- etahat - 1.96 * se
eta_r <- etahat + 1.96 * se
c(exp(eta_l)/(1 + exp(eta_l)), exp(eta_r)/(1 + exp(eta_r)))
```
Therefore is estimated probability is 0.7268, and the 95% confidence interval is (0.6671042, 0.7792529).

## Question 1g
```{r}
# Testing using residual deviance
(p_value <- 1 - pchisq(deviance(logistic), df.residual(logistic)))
```
Given the p-value is 0.03401062, which is less than the significance level of 0.05. Therefore, we reject the null hypothesis, the model is not adequate.
```{r}
# Testing using Pearson Chi-square test
(p_value <- 1 - pchisq(sum(resid(logistic, type = 'pearson')^2), df.residual(logistic)))
```
In the case of using Pearson $\chi^2$ test, the p-value is 0.05948877, which is slightly above the significance level of 0.05. Therefore, we claim the model is adequate.

## Question 1h
```{r}
par(mar=c(4,4,1,1))
plot(x, resid(logistic, type = 'deviance'), xlab = 'X', ylab = 'Deviance residuals')
```
No evidence of a pattern can be seen from the plot, range of deviance residuals are bounded between -2 and 2.

## Question 1i
```{r}
quad.logistic <- glm(y/n ~ x + I(x^2), family = binomial, weight = n)

# Performing likelihood ratio test between straight line model and quadratic logistic model
anova(logistic, quad.logistic, test = "LRT")
```
Given the p-value is 0.0035, which is less than the significance level of 0.05, the quadratic term is relevant. Therefore, we claim that the quadratic model provides a better fit. \newpage

## Question 2a
```{r}
educ <- rep(6:17, 2)
agree <- c(25, 27, 75, 29, 32, 36, 115, 31, 28, 9, 15, 3, 17, 26, 91, 30, 55, 50, 190, 17, 18, 7, 13, 3)
disagree <- c(9, 15, 49, 29, 45, 59, 245, 70, 79, 23, 110, 29, 5, 16, 36, 35, 67, 62, 403, 92, 81, 34,
              115, 28)
total <- agree + disagree
gender <- c(rep(1, 12), rep(0, 12))
```

```{r}
add.logistic <- glm(agree/total ~ factor(educ) + factor(gender), family = binomial, weight = total)
summary(add.logistic)$coef
```

